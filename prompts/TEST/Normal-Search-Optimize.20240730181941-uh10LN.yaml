type: function
parameters:
  - id: GVDfel1l4BehbFSNYPuJT
    type: string
    key: question
  - id: HW7wdD6kgQf2KdppehntD
    key: keyword4
    type: source
    source:
      variableFrom: tool
      agent:
        projectId: "468966286659944448"
        id: 20240730161725-tUyHnk
        from: assistant
        parameters:
          question: "{{ question }}"
prompts:
  sqwbmXLUMvuDvjiY7Hwxa:
    index: 0
    data:
      type: message
      data:
        id: sqwbmXLUMvuDvjiY7Hwxa
        role: user
        content: "{{ question }}"
outputVariables:
  - id: jQuR5yIutLBv99hRUCRoM
    name: $text
  - id: LvnG8SZocXSmg5ME_eL2E
    name: organic_results
    type: array
    element:
      id: uEXG3mtuFC_ax7-4HagvX
      name: element
      type: object
      properties:
        - id: gscJT-yjzJQ3NTeoS4rSr
          type: string
          name: title
        - id: G0kEz-UZ5uZqLkETfHWm5
          type: string
          name: content
        - id: OzIqr0mzN10Nmc5zjutPK
          type: string
          name: id
id: 20240730181941-uh10LN
createdAt: 2024-07-30T01:30:37.163Z
updatedAt: 2024-07-30T01:30:37.163Z
createdBy: z2qaBKnrTUAobCcqGMbqAMFW5WHpYzL3Kub2D
updatedBy: z2qaBKnrTUAobCcqGMbqAMFW5WHpYzL3Kub2D
name: Normal-Search-Optimize
code: |
  const q = [question, ...(keyword4?.answer || [])];


  const getUserHeader = () => {
    const user = context.get('user');
    return {
      'x-user-did': user?.did,
      'x-user-role': user?.role,
      'x-user-provider': user?.provider,
      'x-user-fullname': user?.fullName && encodeURIComponent(user?.fullName),
      'x-user-wallet-os': user?.walletOS,
    };
  };


  const list = (q || []).map(async (i) => {
    const result = await call({
      name: 'z8ia1WEiBZ7hxURf6LwH21Wpg99vophFwSJdu',
      method: 'GET',
      path: '/api/call/posts/search',
      params: { size: 20, q: i },
    })

    return result.data
  });

  const result = (await Promise.all(list)).flat();
  console.log('搜索数据', result.length)
  console.log('去重数据', uniqBy(result, 'id').length);

  return {
    text: 'hello, AIGNE!',
    organic_results: result;
  }
